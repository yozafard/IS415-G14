```{r}
pacman::p_load(car, olsrr, corrplot, ggpubr, sf, spdep, GWmodel, tmap, tidyverse, gtsummary)
```

```{r}
mamikos_sf <- read_rds("data/mamikos_sf.rds")
mamikos_full <- read_rds("data/mamikos_full.rds")
bw <- read_rds("data/bw.rds")
gwr <- read_rds("data/gwr.rds")
jakarta_sf <- read_rds("data/jakarta_sf.rds")
```



```{r}
mamikos_full <- mamikos_full |>
  mutate(log_price = log(price_monthly))
```

```{r}
ggplot(mamikos_full, aes(x = log_price)) +
  geom_histogram(bins = 30, fill = "#2caa4a", color = "black") +
  labs(title = "Log-Transformed Monthly Price Distribution",
       x = "Log Monthly Price (IDR)",
       y = "Frequency")
```

```{r}
mamikos_sp <- as_Spatial(mamikos_full)
gwr_sf <- gwr$SDF |> st_as_sf() |> st_transform(crs = 4326)
```

```{r}
jakarta_gwr <- jakarta_sf |>
  st_join(gwr_sf) |> # Join data within the polygons
  group_by(geometry) |> # Group by some unique identifier for jakarta_sf polygons
  summarise(across(where(is.numeric), ~mean(.x, na.rm = TRUE)), .groups = "drop")
```

```{r}
write_rds(jakarta_gwr, "data/jakarta_gwr.rds")
```

```{r}
mamikos_palette <- colorRampPalette(c("#f95516", "#dbdbdb", "#2caa4a"))(100)

tmap_mode("view")
tm_shape(jakarta_gwr) +  # Your spatial polygons data
  tm_polygons(col="size",  # The variable to color by
              style="quantile",  # The method for creating color breaks
              palette=mamikos_palette,  # Your chosen color palette
              title="Local R2") +  # Legend title
  tm_view(set.zoom.limits = c(11,14))  # Set zoom limits

tmap_mode("plot")
```

